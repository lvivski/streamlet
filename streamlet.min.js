!function(t){"use strict";function n(t){if(this.__listeners__=[],arguments.length>0){var n=new e(this);if("function"==typeof t)try{t(function(t){n.next(t)},function(t){n.fail(t)},function(){n.done()})}catch(o){n.fail(o)}else t&&(this.isSync=!0)}}function e(t){this.stream=t}function o(t,e){var o=n.create(!0);return t.addEventListener(e,function(t){o.add(t)},!1),o.stream}function r(t){return t&&"function"==typeof t}function i(t){if(1===t.length&&Array.isArray(t[0]))return t[0];for(var n=new Array(t.length),e=0;e<n.length;)n[e]=t[e++];return n}function u(t){var n=Array.prototype.slice.call(arguments,1);f(function(){t.apply(null,n)})}var f;"function"==typeof define&&define.amd?define(["subsequent"],function(t){return f=t,n}):"object"==typeof module&&module.exports?(module.exports=n,f=require("subsequent")):(t.Streamlet=n,f=t.subsequent),n.prototype.isDone=!1,n.prototype.isSync=!1,n.prototype.listen=function(t,n,e){if(!this.isDone){var o=this.__listeners__,r={next:t,fail:n,done:e};return o.push(r),function(){var t=o.indexOf(r);o.splice(t,1)}}},n.prototype.transform=function(t){var o=new e(new n(this.isSync));return this.listen(t(o),function(t){o.fail(t)},function(){o.done()}),o.stream},n.prototype.map=function(t){return this.transform(function(n){return function(e){e=t(e),n.add(e)}})},n.prototype.filter=function(t){return this.transform(function(n){return function(e){t(e)&&n.add(e)}})},n.prototype.skip=function(t){return this.transform(function(n){return function(e){t-->0?n.done():n.add(e)}})},n.prototype.take=function(t){return this.transform(function(n){return function(e){t-->0?n.add(e):n.done()}})},n.prototype.expand=function(t){return this.transform(function(n){return function(e){e=t(e);for(var o in e)n.add(e[o])}})},n.prototype.merge=function(t){return n.merge(this,t)},e.NEXT="next",e.FAIL="fail",e.DONE="done",e.prototype.add=e.prototype.next=function(t){this.update(e.NEXT,t)},e.prototype.fail=function(t){this.update(e.FAIL,t)},e.prototype.done=function(){this.update(e.DONE)},e.prototype.update=function(t,n){var o=this.stream;o.isDone||(o.isSync?e.handle(o.__listeners__,t,n):u(e.handle,o.__listeners__,t,n),t!==e.NEXT&&(o.isDone=!0,o.__listeners__=void 0))},e.handle=function(t,n,e){if(t.length)for(var o=0;o<t.length;){var i=t[o++],u=i[n],f=i.fail;if(r(u))try{u(e)}catch(s){if(!r(f))throw s;f(s)}}},n.create=function(t){return new e(new n(t))},n.merge=function(t){t=i(t);for(var o=new e(new n),r=function(t){o.add(t)},u=0;u<t.length;)t[u++].listen(r);return o.stream},"object"==typeof window&&(window.on=function(t){return new o(this,t)},"object"==typeof Node&&(Node.prototype.on=window.on))}(this);
//# sourceMappingURL=streamlet.min.js.map